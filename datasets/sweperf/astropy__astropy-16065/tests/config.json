{
  "repo": "astropy/astropy",
  "instance_id": "astropy__astropy-16065",
  "patch": "diff --git a/astropy/utils/diff.py b/astropy/utils/diff.py\nindex 0c77e3ebea87..7e0c947dc65e 100644\n--- a/astropy/utils/diff.py\n+++ b/astropy/utils/diff.py\n@@ -47,6 +47,18 @@ def diff_values(a, b, rtol=0.0, atol=0.0):\n         return a != b\n \n \n+def _ignore_astropy_terminal_size(func):\n+    @functools.wraps(func)\n+    def inner(*args, **kwargs):\n+        from astropy import conf\n+\n+        with conf.set_temp(\"max_width\", -1), conf.set_temp(\"max_lines\", -1):\n+            return func(*args, **kwargs)\n+\n+    return inner\n+\n+\n+@_ignore_astropy_terminal_size\n def report_diff_values(a, b, fileobj=sys.stdout, indent_width=0, rtol=0.0, atol=0.0):\n     \"\"\"\n     Write a diff report between two values to the specified file-like object.\ndiff --git a/docs/changes/utils/16065.bugfix.rst b/docs/changes/utils/16065.bugfix.rst\nnew file mode 100644\nindex 000000000000..ab9b6eef900c\n--- /dev/null\n+++ b/docs/changes/utils/16065.bugfix.rst\n@@ -0,0 +1,2 @@\n+Update ``report_diff_values`` so the diff no longer depends on the\n+console terminal size.\n",
  "test_patch": "diff --git a/astropy/utils/tests/test_diff.py b/astropy/utils/tests/test_diff.py\nindex a581dba1108d..61317e3e7810 100644\n--- a/astropy/utils/tests/test_diff.py\n+++ b/astropy/utils/tests/test_diff.py\n@@ -145,6 +145,17 @@ def test_tablediff():\n     assert report_diff_values(a, a, fileobj=f)\n \n \n+def test_large_table_diff():\n+    # see https://github.com/astropy/astropy/issues/14010\n+    colnames = [f\"column{i}\" for i in range(100)]\n+    t1 = Table(names=colnames)\n+\n+    colnames.insert(50, \"test\")\n+    t2 = Table(names=colnames)\n+\n+    assert not report_diff_values(t1, t2, fileobj=io.StringIO())\n+\n+\n @pytest.mark.parametrize(\"kwargs\", [{}, {\"atol\": 0, \"rtol\": 0}])\n def test_where_not_allclose(kwargs):\n     a = np.array([1, np.nan, np.inf, 4.5])\n",
  "base_commit": "48a792f9d8dc659f428e9c6f0e9e9964a1b60682",
  "head_commit": "7eac388cd073eb50f44afac72ae90c244bb390c2",
  "created_at": 1708338390000,
  "version": "v5.3",
  "duration_changes": "[{\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.02040262147784233, \"head\": 0.02043941244482994}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.013669546693563461, \"head\": 0.013565678149461746}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.02114231139421463, \"head\": 0.019875191152095795}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.013815231621265411, \"head\": 0.013964541256427765}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.019916370511054993, \"head\": 0.019843127578496933}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.0138627290725708, \"head\": 0.013980701565742493}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.02031116932630539, \"head\": 0.01929694414138794}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.01411660760641098, \"head\": 0.013630472123622894}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.019179873168468475, \"head\": 0.02024690806865692}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.01358788087964058, \"head\": 0.013597443699836731}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.019550282508134842, \"head\": 0.019208379089832306}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.014255795627832413, \"head\": 0.01364167034626007}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.025777947157621384, \"head\": 0.018991630524396896}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.013627257198095322, \"head\": 0.013680737465620041}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.01998138055205345, \"head\": 0.02032996341586113}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.013552222400903702, \"head\": 0.01382821798324585}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.019799258559942245, \"head\": 0.019902706146240234}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.013434626162052155, \"head\": 0.013788197189569473}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.020433392375707626, \"head\": 0.01990547776222229}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.013608932495117188, \"head\": 0.013716965913772583}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.020748674869537354, \"head\": 0.019594375044107437}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.013629890978336334, \"head\": 0.013868402689695358}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.02429717779159546, \"head\": 0.020091019570827484}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.013931818306446075, \"head\": 0.013800062239170074}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.01943941041827202, \"head\": 0.02056310325860977}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.013709120452404022, \"head\": 0.013530705124139786}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.01985590159893036, \"head\": 0.018872786313295364}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.01393979787826538, \"head\": 0.013679802417755127}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.02057817578315735, \"head\": 0.019747518002986908}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.013668954372406006, \"head\": 0.013855699449777603}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.020890962332487106, \"head\": 0.019212104380130768}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.014143165200948715, \"head\": 0.013676289469003677}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.020695563405752182, \"head\": 0.01914156973361969}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.014041673392057419, \"head\": 0.014066841453313828}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.01902451366186142, \"head\": 0.01939522847533226}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.013752102851867676, \"head\": 0.013624310493469238}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.020389586687088013, \"head\": 0.019058004021644592}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.014006588608026505, \"head\": 0.01352587342262268}}, {\"astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]\": {\"base\": 0.02000579610466957, \"head\": 0.024018239229917526}, \"astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]\": {\"base\": 0.01381487026810646, \"head\": 0.013625402003526688}}]",
  "efficiency_test": [
    "astropy/timeseries/periodograms/lombscargle/tests/test_statistics.py::test_distribution[False-True-log]",
    "astropy/units/tests/test_quantity_decorator.py::test_kwarg_default[7-1]"
  ],
  "patch_functions": "{\"astropy/utils/diff.py\": [\"report_diff_values\"]}",
  "problem_statement_oracle": "Please enhance the computational efficiency and execution speed across the entire repository. The optimization efforts may target one or more objective functions, including but not limited to:\n{'astropy/utils/diff.py': ['report_diff_values']}\nThe following conditions apply:\n1. Acceleration of at least one objective function is sufficient for success, as performance evaluations will be conducted collectively on all targeted functions.\n2. Optimization may be achieved either directly through modifications to the objective functions or indirectly by improving computationally intensive subroutines upon which they depend.\n3. Optimization efforts should prioritize maximal efficiency gains where feasible.\n4. All existing unit tests must remain unaltered to preserve functional correctness.",
  "test_functions": "{\"astropy/units/decorators.py\": [\"as_decorator\", \"wrapper\"], \"astropy/timeseries/periodograms/lombscargle/core.py\": [\"LombScargle.distribution\", \"LombScargle\", \"LombScargle.autopower\"], \"astropy/units/quantity.py\": [\"Quantity.unit\"]}",
  "problem_statement_realistic": "Please enhance the computational efficiency and execution speed across the entire repository. The optimization efforts may target one or more objective functions, including but not limited to:\ndefaultdict(<class 'list'>, {'astropy/units/decorators.py': ['as_decorator', 'wrapper'], 'astropy/timeseries/periodograms/lombscargle/core.py': ['LombScargle.distribution', 'LombScargle', 'LombScargle.autopower'], 'astropy/units/quantity.py': ['Quantity.unit']})\nThe following conditions apply:\n1. Acceleration of at least one objective function is sufficient for success, as performance evaluations will be conducted collectively on all targeted functions.\n2. Optimization may be achieved either directly through modifications to the objective functions or indirectly by improving computationally intensive subroutines upon which they depend.\n3. Optimization efforts should prioritize maximal efficiency gains where feasible.\n4. All existing unit tests must remain unaltered to preserve functional correctness.",
  "human_performance": 0.0045000000000000005
}